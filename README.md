# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Основные компоненты

### Базовые классы 

  1. ```Api``` Класс Api предназначен для взаимодействия с API через HTTP-запросы. Класс реализует базовые функции работы с API, такие как отправка запросов и обработка ответов. Он содержит свойства ```baseUrl``` (cтрока, представляющая базовый URL для всех запросов API), ```options``` (параметры запроса, которые могут быть настроены по умолчанию), а так же методы:
    -  ```get(uri: string)``` Отправляет запрос GET на заданный uri и возвращает Promise с данными ответа, обработанными handleResponse;
    -  ```post(uri: string, data: object, method: ApiPostMethods = 'POST')``` Отправляет запрос POST, PUT или DELETE на заданный uri с указанными данными data и возвращает Promise с данными ответа, обработанными handleResponse
    - Защищенный метод ```handleResponse(response: Response)``` Oбрабатывает ответ API, возвращая JSON данные, если запрос успешен, или отклоняя промис в случае ошибк.

  2. ```Component``` Абстрактный базовый класс для создания пользовательских компонентов, работающих с DOM-элементами. Основные методы класса: 
    - ```toggleClass(element: HTMLElement, className: string, force?: boolean)``` - переключает заданный класс для элемента element. Если force задан, класс будет добавлен или удален в зависимости от его значения; 
    - ```setText(element: HTMLElement, value: unknown)``` - устанавливает текстовое содержимое элемента element с заданным значением value; 
    - ```setDisabled(element: HTMLElement, state: boolean)``` - меняет статус блокировки; 
    - ```setHidden(element: HTMLElement)``` - скрывает element; 
    - ```setVisible(element: HTMLElement)``` - показывает element; 
    - ```setImage(element: HTMLImageElement, src: string, alt?: string)``` - eстанавливает изображение src и альтернативный текст alt для элемента element
    - ```render(data?: Partial<T>): HTMLElement``` - метод рендера компонента. Принимает необязательные данные data для обновления состояния компонента и возвращает корневой DOM-элемент (container).

  3. ```EventEmitter``` Класс, прредоставляет методы для управления событиями в приложении, включая установку и удаление обработчиков, инициирование событий и прослушивание всех событий. Содержит свойство ```_events``` (Карта (Map) для хранения событий и соответствующих им списков подписчиков (Set)) и методы: 
    - ```on<T extends object>(eventName: EventName, callback: (event: T) => void)``` устанавливает обработчик callback для события eventName;
    - ```off(eventName: EventName, callback: Subscriber)``` cнимает обработчик callback для события eventName;
    - ```emit<T extends object>(eventName: string, data?: T)``` инициирует событие eventName с переданными данными data. Вызывает все обработчики, зарегистрированные на это событие;
    -  ```onAll(callback: (event: EmitterEvent) => void)``` устанавливает обработчик callback на все события
    -  ```offAll()``` cбрасывает все обработчики событий, очищая карту _events;
    -  ```trigger<T extends object>(eventName: string, context?: Partial<T>)``` возвращает коллбек, который вызывает emit для события eventName с контекстом context.

  4. ```Model``` Абстрактный класс для создания моделей данных с поддержкой событий. Класс предназначен для управления данными и извещения других компонентов об изменениях в моделях.

## Элементы и функции, описаные в интерфейах.

### Классы слоя отображения 

1. ```Modal``` Класс для работы с модальными окнами в приложении. Предоставляет методы для открытия, закрытия и обновления содержимого модального окна, а также поддерживает обработку событий. Содержит свойства ```_content``` и ```closeButton```, отвечающие за содержимое моадльного окна и кнопку закрытия соответственно и реализует следующие методы: 
  - ```openModal()``` - открыват модальное окно;
  - ```closeModal()``` - закрывает модальное окно при клике на оверлей или кнопку закрытия;
  - ```render(changeButton)``` - отрисовывает содержимое модального  окна в зависимости от того, где требуется его открытие - в карточке или в корзине;

2. ```Basket``` Предназначен для управления корзиной покупок, включая добавление и удаление элементов, а также отображение их в DOM-элементе списка корзины. Этот класс позволяет управлять содержимым корзины в приложении. Содержит свойства ```_list``` (элемент списка корзины (HTMLElement), где будут отображаться товары), ```_total``` (элемент для отображения общей стоимости товаров в корзине) и ```_button``` (кнопка для выполнения действий с корзиной (HTMLButtonElement)). Методы класса:
  - ```set items(items: HTMLElement[])``` Устанавливает элементы корзины. Если items пустой, отображает сообщение о том, что корзина пуста. В противном случае, заменяет содержимое списка корзины на переданные элементы.
  - ```set total(total: number): void``` Устанавливает общую сумму товаров в корзине.

3. ```BasketItem``` Компонент для отображения отдельного товара в корзине покупок. Обеспечивает возможность отображения информации о товаре и выполнения действий с ним. Содержит свойства `````, `````, `````, ````` и методы:
  - ```set counter(value: string): void``` Устанавливает значение счетчика товара$;
  - ```set title(value: string): void``` Устанавливает название товара;
  - ```set price(value: string): void``` Устанавливает цену товара.


4. ```Card``` Предназначен для управления карточками в приложении, включая настройку различных атрибутов карточки, таких как идентификатор, заголовок, цена, изображение, описание и категория. Предоставляет методы для взаимодействия с карточками и их элементов. Обязательные свойства класса: ```_id```, ```_title```, ```_price```. Опциональные свойства: ```_description```, ```_image```, ```_category```, ```_button``` и ```_categoryColor``` (Карта (Map) для соответствия категорий с классами стилей). Класс так же будет реализовать одноименные сеттеры и геттеры для установки значений свойств.

5. ```PaymentForm``` Специализация формы для управления данными о платеже. Он наследует функциональность базового класса Form<IPayment> и предоставляет дополнительные возможности для управления кнопками выбора метода оплаты и полями адреса доставки. Свойства: ```container``` - HTML-элемент формы данных о платеже, ```events``` - Объект для работы с событиями. Методы:
  - ```set address(value: string)``` Устанавливает значение поля "адрес доставки";
  - ```setPaymentButton(name: string)``` Устанавливает активное состояние для кнопок выбора метода оплаты.

6. ```ContactsForm``` Cпециализация формы для управления контактными данными заказа. Наследует классу Form<IOrder>. Содержит свойства ```container``` - HTML-элемент формы контактных данных, и ```events``` - объект для работы с событиями. Методы:
  - ```set phone(value: string)``` Устанавливает значение поля "телефон";
  - ```set email(value: string)``` Устанавливает значение поля "электронная почта"

7. ```Page``` Предназначен для управления страницей в приложении, включая настройку списка продуктов, блокировку и разблокировку страницы, а также обработку событий, связанных с корзиной. Содержит свойства  ```_cardList``` (элемент списка карточек продуктов (HTMLElement), где отображаются товары на странице), ```_basket``` (элемент корзины (HTMLElement) в заголовке страницы), ```_basket_counter``` (элемент для отображения количества товаров в корзине) и ```_pageWrapper``` (элемент обертки страницы (HTMLElement), который может быть заблокирован). Методы класса:
  - ```set productList(items: HTMLElement[])``` Устанавливает список продуктов, заменяя содержимое списка карточек на переданные элементы.
  - ```set locked(value: boolean)``` Устанавливает состояние заблокировки страницы. 

8. ```Success``` Компонент для отображения сообщения об успешном завершении операции или процесса. Наследует классу Component<ISuccess> и обеспечивает возможность закрытия сообщения и отображения общей суммы операции. Не содержит методов. Содержит свойства:
  - ```container``` HTML-элемент, в который будет рендериться сообщение об успешном завершении операции; 
  - ```actions``` Объект, содержащий действия, которые могут быть выполнены при взаимодействии с сообщением (например, закрытие)
  - ```total``` Общая сумма операции, которая будет отображаться в сообщении.


   
### Классы слоя данных

1. ```LarekApi``` Предназначен для работы с API приложения и загрузки данных о товарах и списках товаров. Он учитывает расположение CDN для правильного указания путей к изображениям товаров, обеспечивая корректное взаимодействие с внешними сервисами и источниками данных. Содержит единственное доступное только для чтения свойство ```cdn``` и следующие методы:
  - ```getProductItem(id: string): Promise<ICard>``` Получает данные о товаре по его идентификатору (id). Возвращает объект с данными о товаре (ICard), включая путь к изображению, который является полным URL, построенным на основе CDN и пути к изображению; 
  - ```getProductList(): Promise<ICard[]>``` Получает список товаров из API. Возвращает массив объектов с данными о товарах (ICard[]), включая полные URL-адреса изображений товаров, построенные на основе CDN и путей к изображениям.
  - ```sendOrder(order: IOrder)``` Выполняет отправку заказа на сервер. Он принимает объект order типа IOrder, который содержит информацию о заказе, а затем выполняет POST-запрос к серверу, отправляя этот объект.

2. ```AppData``` Основной класс, предназначенный для работы с данными в приложении. Cвойства и методы класса:
  - ```items``` Массив товаров (ICard[]), содержащий все товары; 
  - ```catalog``` Массив товаров (ICard[]), представляющий каталог товаров; 
  - ```basket``` Массив товаров (ICard[]), представляющий корзину покупок; 
  - ```preview``` Предварительный просмотр товара (null или строка), представляющий идентификатор выбранного для предварительного просмотра товара;
  - ```order``` Объект заказа (IOrder), содержащий информацию о текущем заказе, включая email, телефон, адрес, способ оплаты, общую стоимость и список товаров.
  - ```setItems(items: ICard[]): ICard[]``` Устанавливает список элементов для отображения в приложении; 
  - ```setPreview(item: ICard): void``` Устанавливает предпросмотр выбранного элемента;
  - ```addToBasket(item: ICard): void``` Добавляет элемент в корзину;
  - ```removeItem(id: string): void``` Удаляет элемент из корзины по его идентификатору;
  - ```getTotal(): number``` Вычисляет общую стоимость элементов в корзине;
  - ```validatePaymentForm(): boolean``` Проверяет форму оплаты на наличие ошибок и генерирует соответствующие события; 
  - ```validateContactsForm(): boolean``` Проверяет форму контактных данных на наличие ошибок и генерирует соответствующие события; 
  - ```isItemSelected(item: ICard): boolean``` Проверяет, выбран ли указанный элемент;
  - ```setAddress(value: string): void``` Устанавливает значение адреса доставки и выполняет проверку формы оплаты; 
  - ```setContacts(field: keyof IContact, value: string): void``` Устанавливает значение указанного поля контактных данных и выполняет проверку формы контактов; 
  - ```setOrderData(): void``` Устанавливает данные заказа на основе элементов в корзине и общей суммы; 
  - ```clearOrderForm(): void``` Очищает данные о заказе (форму заказа);
  - ```clearOrder(): void``` Очищает корзину и данные о заказе; 
  
3. ```Form``` Абстрактный класс, создает экземпляр формы, который обрабатывает ввод данных пользователя и отображает сообщения об ошибках. Он принимает два параметра ```container``` (HTML-элемент формы)  и ```events``` (oбъект для работы с событиями). Класс предоставляет следующие методы и свойства: 
  - ```valid``` Свойство для управления доступностью кнопки отправки формы; 
  - ```errors``` Свойство для установки сообщений об ошибках;
  - ```render(state: Partial<T> & IForm)``` Метод для отображения формы с учетом переданного состояния.

Класс также содержит внутренние методы для обработки событий ввода данных и отправки формы. Эти методы генерируют соответствующие события, что позволяет другим частям приложения реагировать на изменения в форме.

## Слой Presenter

Слой Presenter в проекте содержится в файле index.ts и реализуется в основном через объект класса EventEmitter, связывающий даанные и отображение между собой по иницилаизации тех или иных событий.

Список инициируемых событий:

1. ```items:change``` Изменениее массива товаров.  Запускает сеттер объектра класса Page, рендерит карточки товаров в галеерее.

2. ```card:select``` "Выбирает" карточку по клику. Получает данные о товаре, которые необходимо подставить в модальное окно.

3. ```preview:changed``` Плоучает с сервера данные для конкретногоотвара по id, открывает модально окно, отрендерив в нем карточку конкретного товара.

4. ```item:add``` Срабатывает по клику на кнопку "Купить". Добавляет данные конкретного товара в корзину

5. ```item:remove``` Срабатывает по клику на кнопку удаления в карточке товара в корзине. Удаляет товар и данные о нем.

6. ```modal:open``` Открывает модальное окно приклике на соответстсвующую область. Включает блокировку прокрутки при открытом модальном окне

7. ```modal:close``` Закрывает модальное окно. Отключает блокировку прокрутки

8. ```order:open``` срабатывает при клике на кнопку "оформить" в корзине, инициирует переключение содержимого модального окна на первую вкладку оформления заказа.

9. ```contacts:open``` Переключает содержимое мощдального окна на форму с контактными данными

10. ```contacts:submit``` Переключает содержимое модального окна на заглушку с сообщением об успешном выполнении заказа.

11. ```basket:open``` Инициируется кликом по иконке корзины и ее открытием. Рендерит в модальное окно добавленные товары, запускает "проверку на пустоту" - при пустой корзине кнопка оформления становится неактивна

12. ```basketList:changed``` Вызывается при изменении содержимого корзины (добавление или удаление товара.)

13. ```paymentMethod:changed``` Инициируется кликом по кнопке того или иного способа оплатыы товара

14. ```formErrors:change``` Вызывается при изменении ошибок в форме.

15. ```/^contacts\..*:change/``` Вызывается при изменении значения поля в форме контактных данных.

16. ```/^order\..*:change/``` Вызывается при изменении значения поля в форме оформления заказа
